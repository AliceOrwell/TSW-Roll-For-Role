<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>TSW Roll For Role</title>
	</head>
	<body>
    <a href="https://github.com/AliceOrwell/TSW-Roll-For-Role"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

		<div id="header">
			<h1>TSW Roll For Role</h1>
		</div>

		<div id="javascriptnotice">
			This page requires Javascript. You're seeing this message as you have Javascript disabled.
		</div>

		<div class="leftpanel">
			<h2>About</h2>
			<p>This is a silly web interface to assign random roles for the videogame
        <a href="http://www.thesecretworld.com/">The Secret World</a>
        (TSW), a MMORPG by <a href="http://www.funcom.com/">Funcom</a>.
      </p>

			<h2>Instructions</h2>
			<p>1. Populate the Roles section by selecting a preset from the Presets
        dropdown.
      </p>
      <p>2. Copy &amp; paste your rolls sort from your TSW chat window into the
        Rolls box. Your role assignments will automatically
        appear in the Output box.
      </p>

      <h2>See Also</h2>
      <a href="https://aliceorwell.github.io/TSW-Roll-Sorter/">TSW Roll Sorter</a>
		</div>
		<div class="rightpanel">
			<form>
				<div>
				  <label for="role-presets" class="for-select">Presets:</label>
				  <select name="role-presets" id="role-presets"></select>
				</div>
				<div>
				  <label for="roles">Roles:</label>
				  <textarea name="roles" id="roles" rows="10" cols="70"></textarea>
				</div>
				<div>
					<label for="rolls">Rolls:</label>
					<textarea name="rolls" id="rolls" rows="10" cols="70"></textarea>
				</div>
				<input type="submit" id="submit" value="Process" />
				<div class="output">
					<label for="output">Output:</label>
					<textarea name="output" id="output" rows="7" cols="70"></textarea>
				</div>
			</form>

			<h2>Example</h2>
			<div class="example">
				<div class="input good">
					Tank (Red)<br />
					Tank (Purple)<br />
					Healer<br />
					DABS (Red)<br />
					DABS (Purple)<br />
					Shade 1<br />
					Shade 2<br />
					Shade 2<br />
					Backup<br />
					Backup
				</div>
				<div class="input good">
					AliceOrwell rolled a 12.<br />
					KangaRue rolled a 92.<br />
					BigMiz rolled a 29.<br />
					LemonWarlord rolled a 32.<br />
					Ayesia rolled a 67.<br />
					Puppycat rolled a 45.<br />
					Kuraikaze rolled a 99.<br />
					Ceryx rolled a 2.<br />
					iLiVeInAbOx rolled a 50.<br />
					Smyrill rolled a 3.
				</div>
				<span class="spacer">-&gt;</span>
				<div class="output good">
					10 Assignment(s) -- Tank (Red) := Kuraikaze :: Tank (Purple) := KangaRue :: Healer := Ayesia :: DABS (Red) := iLiVeInAbOx :: DABS (Purple) := Puppycat :: Shade 1 := LemonWarlord :: Shade 2 := BigMiz :: Shade 2 := AliceOrwell :: Backup := Smyrill :: Backup := Ceryx
				</div>
			</div>
		</div>

    <link rel="stylesheet" href="./css/main.css" type="text/css" />

    <script language="javascript" type="text/javascript" src="./js/jquery-3.1.1.min.js"></script>
    <script language="javascript" type="text/javascript" src="./js/tswrollsorter.js"></script>
		<script language="javascript" type="text/javascript" src="./src/tswrollforrole.js"></script>
		<script>
			window.onload = function(e) {
				// Hide Javascript disabled notice
				document.getElementById('javascriptnotice').style.display = 'none';
			};

      function process() {
        var roles = $( '#roles' ).val();                // Get dirty role data
        roles = tswRollForRole.roleExtracter( roles );  // Extract

        var rolls = $( '#rolls' ).val();        // Get raw data
        rolls = tswrollsorter.extract( rolls ); // Extract
        rolls = tswrollsorter.filter( rolls );  // Filter
        rolls = tswrollsorter.sort( rolls );    // Sort

        var people = [];
        for (var i = 0; i < rolls.length; i++) {
          people.push( rolls[i].person );
        }

        var assignments = tswRollForRole.assigner( roles, people );
        assignments = tswRollForRole.format( assignments );
        $( '#output' ).val( assignments );
      }

      $( document ).ready(function() {
        // Populate Presets dropdown
        var $rolePresets = $( '#role-presets' );
        $.each( rolePresets, function(key, value) {
          var option = $( '<option />' ).val(key).text(key);
          $rolePresets.append(option);
        });

        // Submit button clicked
        $( 'form' ).on('submit', function( event ) {
          event.preventDefault();
          process();
        });

        // Something pasted to rolls
        $( '#rolls' ).on('paste', function( event ) {
          // Brief delay since paste event triggers before content is updated.
          setTimeout(function(){
  					process();
  				}, 0);
        });

        // Populate Roles textarea on dropdown change
        $( '#role-presets' ).on('change', function( event ) {
          var value = $( this ).val();
          var data = tswRollForRole.roleData( value );
          $( '#roles' ).val( data );

          process();
        });
      });
		</script>
	</body>
</html>
